
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Python Script Reader & Editor</title>
  <style>
    body { background: #2b2b2b; color: #f8f8f2; font-family: Arial, sans-serif; margin: 0; }
    .toolbar { margin: 1em; }
    .button { padding: 0.3em 1em; border: none; border-radius: 5px; background: #306998; color: #fff; font-weight: bold; cursor: pointer; }
    .button:disabled { opacity: 0.6; cursor: not-allowed; }
    .editor-wrap { margin: 1em; background: #272822; border-radius: 8px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.07); }
    #editor, #highlighted { width: 100%; min-height: 300px; font-size: 1em; font-family: 'Fira Mono', monospace; border: none; outline: none; background: transparent; color: inherit; padding: 1em; }
    #editor { resize: vertical; }
    #highlighted { white-space: pre; }
    .keyword { color: #66d9ef; }
    .string { color: #e6db74; }
    .comment { color: #75715e; }
    .number { color: #ae81ff; }
    .funcname { color: #a6e22e; }
    .tab { padding: 0.5em 1em; background: #222; color: #fff; border: none; cursor: pointer; border-radius: 5px 5px 0 0; margin-right: 3px; }
    .tab.active { background: #306998; }
    .tab .close { margin-left: 6px; color: #aaa; cursor: pointer; }
    .searchbar { margin: 1em; }
    .search-highlight { background: yellow; color: black; }
  </style>
</head>
<body>
  <div class="toolbar">
    <button class="button" id="editBtn">Edit</button>
    <button class="button" id="viewBtn">View</button>
    <input type="file" id="fileInput" accept=".py" multiple>
    <button class="button" id="downloadBtn">Download</button>
    <button class="button" id="newTabBtn">New File</button>
    <span id="tabs"></span>
  </div>
  <div class="searchbar">
    <input type="text" id="searchInput" placeholder="Search code...">
    <button class="button" id="searchBtn">Find</button>
    <span id="searchCount"></span>
  </div>
  <div class="editor-wrap">
    <textarea id="editor"></textarea>
    <pre id="highlighted" style="display:none"></pre>
  </div>
  <script>
    // --- Data Model ---
    let files = [{name:"Untitled.py", content:'print("Hello, world!")', searchMatches:[]}];
    let activeTab = 0;
    let mode = 'edit'; // or 'view'

    function escapeHTML(s) {
      return s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    }

    const keywords = ["def","return","if","else","elif","for","while","break","continue","import","from","as","class","try","except","finally","with","pass","raise","in","is","not","and","or","lambda","yield","global","nonlocal","assert","del"];
    function highlightPython(code, searchMatches=[]) {
      let lines = code.split("\n");
      let out = "";
      for (let i=0; i<lines.length; i++) {
        let line = escapeHTML(lines[i]);
        // Comments
        line = line.replace(/(#.*)$/g, '<span class="comment">$1</span>');
        // Strings
        line = line.replace(/('[^']*'|"[^"]*")/g, '<span class="string">$1</span>');
        // Keywords
        for (const kw of keywords) {
          const regex = new RegExp("\\b" + kw + "\\b", "g");
          line = line.replace(regex, `<span class="keyword">${kw}</span>`);
        }
        // Function/Class names
        if (/^\s*def\s+(\w+)/.test(lines[i])) {
          let fn = lines[i].match(/^\s*def\s+(\w+)/)[1];
          line = line.replace(/def (\w+)/, `def <span class="funcname">${fn}</span>`);
        }
        if (/^\s*class\s+(\w+)/.test(lines[i])) {
          let cls = lines[i].match(/^\s*class\s+(\w+)/)[1];
          line = line.replace(/class (\w+)/, `class <span class="funcname">${cls}</span>`);
        }
        // Numbers
        line = line.replace(/\b([0-9]+(\.[0-9]*)?)\b/g, '<span class="number">$1</span>');
        // Search highlight
        if (searchMatches.includes(i)) {
          line = `<span class="search-highlight">${line}</span>`;
        }
        out += line + "\n";
      }
      return out;
    }

    function updateTabs() {
      let tabsDiv = document.getElementById('tabs');
      tabsDiv.innerHTML = "";
      files.forEach((file, idx) => {
        let tab = document.createElement('button');
        tab.className = "tab" + (activeTab===idx?" active":"");
        tab.innerHTML = file.name + ' <span class="close" title="Close Tab">&#10005;</span>';
        tab.onclick = ()=>{activeTab=idx;updateEditor();updateTabs();};
        tab.querySelector('.close').onclick = (e)=>{e.stopPropagation();files.splice(idx,1);if(activeTab>=files.length)activeTab=files.length-1;updateTabs();updateEditor();};
        tabsDiv.appendChild(tab);
      });
      if (files.length === 0) {
        files.push({name: "Untitled.py", content:'print("Hello, world!")', searchMatches:[]});
        activeTab = 0;
        updateTabs();
        updateEditor();
      }
    }

    function updateEditor() {
      let file = files[activeTab];
      document.getElementById('editor').value = file.content;
      document.getElementById('downloadBtn').disabled = false;
      document.getElementById('searchCount').textContent = file.searchMatches && file.searchMatches.length ? "Matches: "+file.searchMatches.length : "";
      if (mode === "edit") {
        document.getElementById('editor').style.display = "";
        document.getElementById('highlighted').style.display = "none";
      } else {
        document.getElementById('highlighted').innerHTML = highlightPython(file.content, file.searchMatches || []);
        document.getElementById('editor').style.display = "none";
        document.getElementById('highlighted').style.display = "";
      }
    }

    document.getElementById('editor').addEventListener('input', function() {
      files[activeTab].content = this.value;
    });

    document.getElementById('fileInput').addEventListener('change', function(e) {
      Array.from(e.target.files).forEach(f=>{
        let reader = new FileReader();
        reader.onload = function(ev) {
          files.push({name: f.name, content: ev.target.result, searchMatches: []});
          activeTab = files.length-1;
          updateTabs();
          updateEditor();
        };
        reader.readAsText(f);
      });
    });

    document.getElementById('downloadBtn').onclick = function() {
      if (!files[activeTab]) return;
      let blob = new Blob([files[activeTab].content], {type:"text/plain"});
      let a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = files[activeTab].name || "script.py";
      a.click();
    };

    document.getElementById('newTabBtn').onclick = function() {
      files.push({name: "Untitled.py", content: 'print("Hello, world!")', searchMatches: []});
      activeTab = files.length-1;
      updateTabs();
      updateEditor();
    };

    document.getElementById('searchBtn').onclick = function() {
      let term = document.getElementById('searchInput').value;
      let lines = files[activeTab].content.split("\n");
      let matches = [];
      if (term) {
        lines.forEach((l,i)=>{if(l.includes(term))matches.push(i);});
      }
      files[activeTab].searchMatches = matches;
      updateEditor();
    };

    document.getElementById('editBtn').onclick = function() {
      mode = 'edit';
      updateEditor();
    };
    document.getElementById('viewBtn').onclick = function() {
      mode = 'view';
      updateEditor();
    };

    // Initial load
    updateTabs();
    updateEditor();
  </script>
</body>
</html>
